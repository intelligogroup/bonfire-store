{"version":3,"file":"intelligo.ai-bonfire-store.js","sources":["ng://@intelligo.ai/bonfire-store/lib/bonfire-store.model.ts","ng://@intelligo.ai/bonfire-store/lib/bonfire-store.service.ts","ng://@intelligo.ai/bonfire-store/lib/bonfire-store.component.ts","ng://@intelligo.ai/bonfire-store/lib/bonfire-store.module.ts","ng://@intelligo.ai/bonfire-store/lib/bonfire-store.util.ts"],"sourcesContent":["import { WithObservable } from '@intelligo.ai/bonfire';\nimport { InjectionToken } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { map, tap } from 'rxjs/operators';\nimport { BonfireStoreService } from './bonfire-store.service';\n\n\n// tslint:disable-next-line: no-namespace\nexport namespace BonfireStore {\n  export type ValueOf<T> = T[keyof T];\n\n  export type ErrorType = 'SERVICE_NOT_FOUND' | 'LOCAL_STORE_NOT_FOUND';\n\n  export type FromStore<T = any> = Observable<T> | T | any;\n\n  export type ServiceTuple<T = any, J = any> = [string, BonfireStoreService<T, J>];\n\n  export interface Config<T = any> {\n    [key: string]: T;\n  }\n\n  export const BONFIRE_CONFIG = new InjectionToken<Config>('BONFIRE_CONFIG');\n\n  export class Store<T> {\n    @WithObservable() public store: T; private store$: BehaviorSubject<T>;\n    constructor(initialValue: T, public name?: string) {\n      if (initialValue) {\n        this.store = initialValue;\n      }\n    }\n\n    get$(\n      key?: keyof T,\n      callback?: (value: BonfireStore.ValueOf<T>) => void\n    ): Observable<BonfireStore.ValueOf<T>> {\n\n      const mapCallback = store => key ? store[key as keyof T] : store;\n\n\n      return this.store$\n        .asObservable()\n        .pipe(\n          map(mapCallback),\n          tap(callback || ((value) => { }))\n        );\n\n    }\n\n    set$<J = any>(key: keyof T, value: J) {\n      this.store[key] = value as any;\n    }\n\n    _get(key: keyof T) {\n      return this.store[key];\n    }\n  }\n\n  export interface SubStores<J = any> {\n    [key: string]: Store<J>;\n  }\n\n\n}\n","import { Inject, Injectable } from '@angular/core';\nimport { WithObservable } from '@intelligo.ai/bonfire';\nimport { BehaviorSubject } from 'rxjs';\nimport { BonfireStore } from './bonfire-store.model';\n\n\n// @dynamic\n@Injectable({\n  providedIn: 'root'\n})\nexport class BonfireStoreService<T, J = any> extends BonfireStore.Store<T> {\n  @WithObservable() private subStores: BonfireStore.Store<J>[] = [];\n  private subStores$: BehaviorSubject<BonfireStore.Store<J>[]>;\n  constructor(\n    @Inject(BonfireStore.BONFIRE_CONFIG) private initialValue: T\n  ) {\n    super(initialValue);\n    this.store = this.initialValue;\n  }\n\n\n  createLocalStore(initialValue: J) {\n    const storeKey = (Math.random() * 1000000000).toFixed();\n    this.subStores.push(new BonfireStore.Store<J>(initialValue, storeKey));\n    return this.subStores[this.subStores.length - 1];\n  }\n\n\n\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'false-bonfire-store',\n  template: `\n    <p>\n      bonfire-store works!\n    </p>\n  `,\n  styles: []\n})\nexport class BonfireStoreComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit() {\n  }\n\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\nimport { BonfireStoreComponent } from './bonfire-store.component';\nimport { BonfireStore } from './bonfire-store.model';\n\n\n// @dynamic\n@NgModule({\n  declarations: [BonfireStoreComponent],\n  imports: [\n  ],\n  exports: [BonfireStoreComponent]\n})\n\n\nexport class BonfireStoreModule {\n  static forRoot(useValue: BonfireStore.Config = {}): ModuleWithProviders<BonfireStoreModule> {\n    return {\n      ngModule: BonfireStoreModule,\n      providers: [\n        { provide: BonfireStore.BONFIRE_CONFIG, useValue }\n      ],\n    };\n  }\n}\n","import { BonfireStoreService } from './bonfire-store.service';\nimport { BonfireStore } from './bonfire-store.model';\nimport * as onChange from 'on-change';\n\n\nfunction handleErrors(errorType: BonfireStore.ErrorType) {\n  let errorMessage: string;\n  switch (errorType) {\n    case 'SERVICE_NOT_FOUND':\n      errorMessage = `\n      Injection Error. Decorator Can't work without injecting the main store service.\n\n      Example:\n\n        constructor(\n          ===> private bonfireStoreService: BonfireStoreService<{ counter: number }, LocalStore>\n        ) { }\n    `;\n      break;\n\n    case 'LOCAL_STORE_NOT_FOUND':\n      errorMessage = `\n      Creation Error. Local store is not found.\n\n      Example:\n\n      ===> localStore = this.bonfireStoreService.createLocalStore('SOME_NAME', { ... });\n\n      constructor(\n        private bonfireStoreService: BonfireStoreService<{ counter: number }, LocalStore>\n      ) { }\n      `\n      break;\n    default:\n      break;\n  }\n\n\n  if (errorMessage) {\n    throw new Error(errorMessage);\n  }\n}\n\n\n\nexport function FromLocalStore<J = any, T = any>(keyName?: keyof T | any) {\n\n  return (target: any, key: keyof T) => {\n    const init = function (isGet: boolean) {\n      return function (newVal?) {\n        const localStore = Object\n          .values(this)\n          .find(value => value instanceof BonfireStore.Store &&\n            !(value instanceof BonfireStoreService)) as unknown as BonfireStore.Store<T>;\n\n        if (!localStore) {\n          handleErrors('LOCAL_STORE_NOT_FOUND');\n        }\n\n        Object.defineProperty(this, key, {\n          get: () => {\n            return localStore.get$(keyName);\n          },\n          set: (val: T) => {\n            localStore.set$(keyName, val);\n          },\n          enumerable: true,\n          configurable: true\n        });\n\n        if (isGet) {\n          return this[key]; // get\n        } else {\n          this[key] = newVal; // set\n        }\n      };\n    };\n\n    return Object.defineProperty(target, key, {\n      get: init(true),\n      set: init(false),\n      enumerable: true,\n      configurable: true\n    });\n  };\n}\n\n\n\nexport function FromStore<T = any, J = any>(name?: keyof T | any) {\n\n  return (target: any, key: keyof T) => {\n    const init = function (isGet: boolean) {\n      return function (newVal?) {\n        const bonfireService = Object\n          .values(this)\n          .find((value): boolean => value instanceof BonfireStoreService) as unknown as BonfireStoreService<T, J>;\n\n        if (!bonfireService) {\n          handleErrors('SERVICE_NOT_FOUND');\n        }\n\n\n        if (!name) {\n          name = key;\n        }\n\n        Object.defineProperty(this, key, {\n          get: () => {\n            return bonfireService.get$(name);\n          },\n          set: (val: T) => {\n            bonfireService.set$(name, val);\n          },\n          enumerable: true,\n          configurable: true\n        });\n\n        if (isGet) {\n          return this[key]; // get\n        } else {\n          this[key] = newVal; // set\n        }\n      };\n    };\n\n    return Object.defineProperty(target, key, {\n      get: init(true),\n      set: init(false),\n      enumerable: true,\n      configurable: true\n    });\n  };\n}\n"],"names":["tslib_1.__decorate"],"mappings":"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"}